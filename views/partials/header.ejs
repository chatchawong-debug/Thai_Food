<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>สารสนเทศอาหารไทย</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
    <link rel="icon" href="icons/Page.png" type="images"/>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".zoom-container img").forEach((img) => {
          img.addEventListener("click", () => {
            img.classList.toggle("zoomed");
            document.body.classList.toggle("no-scroll");
          });
        });
      });

      document.addEventListener("DOMContentLoaded", () => {
        const modalOverlay = document.createElement("div");
        modalOverlay.classList.add("modal-overlay");
        document.body.appendChild(modalOverlay);

        document.querySelectorAll(".zoom-thumbnail").forEach((thumbnail) => {
          thumbnail.addEventListener("click", (event) => {
            // Stop propagation to prevent issues if thumbnail is inside another clickable element
            event.stopPropagation();

            // Create new image element for the modal
            const zoomedImage = document.createElement("img");
            zoomedImage.src = thumbnail.src; // Use the src of the clicked thumbnail
            zoomedImage.alt = thumbnail.alt;
            zoomedImage.classList.add("modal-content");

            // Clear previous content and append new image
            modalOverlay.innerHTML = "";
            modalOverlay.appendChild(zoomedImage);

            modalOverlay.classList.add("active"); // Show the modal
          });
        });

        // Close modal when clicking on the overlay or the image itself
        modalOverlay.addEventListener("click", () => {
          modalOverlay.classList.remove("active");
        });

        // Close modal with Escape key
        document.addEventListener("keydown", (event) => {
          if (
            event.key === "Escape" &&
            modalOverlay.classList.contains("active")
          ) {
            modalOverlay.classList.remove("active");
          }
        });
      });

      // Function to create and show the food detail modal
      function showFoodDetailModal(food) {
        const modal = document.createElement("div");
        modal.classList.add("food-detail-modal");

        const modalContent = document.createElement("div");
        modalContent.classList.add("food-detail-content");

        modalContent.innerHTML = `
        <h3>${food.name}</h3>
        <p><strong>คำอธิบาย:</strong> ${food.des}</p>
        <p><strong>ประเภท:</strong> ${food.type_id}</p>
    `;

        modal.appendChild(modalContent);
        document.body.appendChild(modal);

        // Show the modal after a short delay to allow for the transform transition
        setTimeout(() => {
          modal.classList.add("active");
        }, 10);

        // Close the modal when clicking outside or pressing Escape
        modal.addEventListener("click", (event) => {
          if (event.target === modal) {
            modal.classList.remove("active");
            setTimeout(() => modal.remove(), 400); // Remove element after transition
          }
        });

        document.addEventListener(
          "keydown",
          (event) => {
            if (event.key === "Escape" && modal.classList.contains("active")) {
              modal.classList.remove("active");
              setTimeout(() => modal.remove(), 400);
            }
          },
          { once: true }
        ); // Use { once: true } to prevent multiple listeners
      }

      // Add click listener to all food name links
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".food-name-link").forEach((link) => {
          link.addEventListener("click", (event) => {
            event.preventDefault(); // Prevent the link from jumping to the top of the page
            const foodData = JSON.parse(link.dataset.food); // Parse the JSON data
            showFoodDetailModal(foodData);
          });
        });
      });

      document.addEventListener("DOMContentLoaded", () => {
        const searchInput = document.getElementById("search-input");
        const foodTable = document.getElementById("food-table");
        const tableRows = foodTable.querySelectorAll("tbody tr");

        function filterTable() {
          const searchTerm = searchInput.value.toLowerCase();

          tableRows.forEach((row) => {
            // เราจะค้นหาจากคอลัมน์ "Name"
            const nameCell = row.querySelector("td:nth-child(3)");
            if (nameCell) {
              const foodName = nameCell.textContent.toLowerCase();
              if (foodName.includes(searchTerm)) {
                row.style.display = ""; // แสดงแถวนี้
              } else {
                row.style.display = "none"; // ซ่อนแถวนี้
              }
            }
          });
        }

        // เรียกใช้ฟังก์ชันค้นหาเมื่อผู้ใช้พิมพ์ในช่อง input
        searchInput.addEventListener("keyup", filterTable);

        // เรียกใช้ฟังก์ชันค้นหาเมื่อคลิกปุ่มค้นหา
        const searchButton = document.getElementById("search-button");
        searchButton.addEventListener("click", filterTable);
      });

      document.addEventListener("DOMContentLoaded", () => {
        const searchInput = document.getElementById("type-search-input");
        const typeTable = document.getElementById("type-table");
        const tableRows = typeTable.querySelectorAll("tbody tr");

        function filterTable() {
          const searchTerm = searchInput.value.toLowerCase();

          tableRows.forEach((row) => {
            // คอลัมน์ "Name" ในตารางประเภทอาหารคือคอลัมน์ที่ 2
            const nameCell = row.querySelector("td:nth-child(2)");
            if (nameCell) {
              const typeName = nameCell.textContent.toLowerCase();
              if (typeName.includes(searchTerm)) {
                row.style.display = ""; // แสดงแถวนี้
              } else {
                row.style.display = "none"; // ซ่อนแถวนี้
              }
            }
          });
        }

        // เรียกใช้ฟังก์ชันค้นหาเมื่อมีการพิมพ์ในช่อง input
        searchInput.addEventListener("keyup", filterTable);

        // เรียกใช้ฟังก์ชันค้นหาเมื่อคลิกปุ่มค้นหา
        const searchButton = document.getElementById("type-search-button");
        searchButton.addEventListener("click", filterTable);
      });
    </script>
  </head>
  <body>
    <header>
      <nav>
        <a href="/"><img src="icons/Home.png" alt="หน้าหลัก" class="nav-icon"> หน้าแรก </a> | 
        <a href="/food"><img src="icons/Menu.png" alt="รายการอาหาร" class="nav-icon"> รายการอาหาร </a> | 
        <a href="/type"><img src="icons/Type.png" alt="ประเภทอาหาร" class="nav-icon"> ประเภทอาหาร </a>
      </nav>
    </header>
  </body>
</html>
