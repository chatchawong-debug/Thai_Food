<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>สารสนเทศอาหารไทย</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-fork-knife' viewBox='0 0 16 16'%3E%3Cpath d='M13 .5c0-.276-.226-.506-.498-.465-1.703.257-2.94 2.012-3 8.462a.5.5 0 0 0 .498.5c.56.01 1 .13 1 1.003v5.5a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5zM4.25 0a.25.25 0 0 1 .25.25v5.122a.128.128 0 0 0 .256.006l.233-5.14A.25.25 0 0 1 5.24 0h.522a.25.25 0 0 1 .25.238l.233 5.14a.128.128 0 0 0 .256-.006V.25A.25.25 0 0 1 6.75 0h.29a.5.5 0 0 1 .498.458l.423 5.07a1.69 1.69 0 0 1-1.059 1.711l-.053.022a.92.92 0 0 0-.58.884L6.47 15a.971.971 0 1 1-1.942 0l.202-6.855a.92.92 0 0 0-.58-.884l-.053-.022a1.69 1.69 0 0 1-1.059-1.712L3.462.458A.5.5 0 0 1 3.96 0z'/%3E%3C/svg%3E"
      type="image/svg+xml"
    />
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".zoom-container img").forEach((img) => {
          img.addEventListener("click", () => {
            img.classList.toggle("zoomed");
            document.body.classList.toggle("no-scroll");
          });
        });
      });
      document.addEventListener("DOMContentLoaded", () => {
        const modalOverlay = document.createElement("div");
        modalOverlay.classList.add("modal-overlay");
        document.body.appendChild(modalOverlay);

        document.querySelectorAll(".zoom-thumbnail").forEach((thumbnail) => {
          thumbnail.addEventListener("click", (event) => {
            // Stop propagation to prevent issues if thumbnail is inside another clickable element
            event.stopPropagation();

            // Create new image element for the modal
            const zoomedImage = document.createElement("img");
            zoomedImage.src = thumbnail.src; // Use the src of the clicked thumbnail
            zoomedImage.alt = thumbnail.alt;
            zoomedImage.classList.add("modal-content");

            // Clear previous content and append new image
            modalOverlay.innerHTML = "";
            modalOverlay.appendChild(zoomedImage);

            modalOverlay.classList.add("active"); // Show the modal
          });
        });

        // Close modal when clicking on the overlay or the image itself
        modalOverlay.addEventListener("click", () => {
          modalOverlay.classList.remove("active");
        });

        // Close modal with Escape key
        document.addEventListener("keydown", (event) => {
          if (
            event.key === "Escape" &&
            modalOverlay.classList.contains("active")
          ) {
            modalOverlay.classList.remove("active");
          }
        });
      });

      // Function to create and show the food detail modal
      function showFoodDetailModal(food) {
        const modal = document.createElement("div");
        modal.classList.add("food-detail-modal");

        const modalContent = document.createElement("div");
        modalContent.classList.add("food-detail-content");

        modalContent.innerHTML = `
        <h3>${food.name}</h3>
        <p><strong>คำอธิบาย:</strong> ${food.des}</p>
        <p><strong>ประเภท:</strong> ${food.type_id}</p>
    `;

        modal.appendChild(modalContent);
        document.body.appendChild(modal);

        // Show the modal after a short delay to allow for the transform transition
        setTimeout(() => {
          modal.classList.add("active");
        }, 10);

        // Close the modal when clicking outside or pressing Escape
        modal.addEventListener("click", (event) => {
          if (event.target === modal) {
            modal.classList.remove("active");
            setTimeout(() => modal.remove(), 400); // Remove element after transition
          }
        });

        document.addEventListener(
          "keydown",
          (event) => {
            if (event.key === "Escape" && modal.classList.contains("active")) {
              modal.classList.remove("active");
              setTimeout(() => modal.remove(), 400);
            }
          },
          { once: true }
        ); // Use { once: true } to prevent multiple listeners
      }

      // Add click listener to all food name links
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".food-name-link").forEach((link) => {
          link.addEventListener("click", (event) => {
            event.preventDefault(); // Prevent the link from jumping to the top of the page
            const foodData = JSON.parse(link.dataset.food); // Parse the JSON data
            showFoodDetailModal(foodData);
          });
        });
      });

      document.addEventListener("DOMContentLoaded", () => {
        const searchInput = document.getElementById("search-input");
        const foodTable = document.getElementById("food-table");
        const tableRows = foodTable.querySelectorAll("tbody tr");

        function filterTable() {
          const searchTerm = searchInput.value.toLowerCase();

          tableRows.forEach((row) => {
            // เราจะค้นหาจากคอลัมน์ "Name"
            const nameCell = row.querySelector("td:nth-child(3)");
            if (nameCell) {
              const foodName = nameCell.textContent.toLowerCase();
              if (foodName.includes(searchTerm)) {
                row.style.display = ""; // แสดงแถวนี้
              } else {
                row.style.display = "none"; // ซ่อนแถวนี้
              }
            }
          });
        }

        // เรียกใช้ฟังก์ชันค้นหาเมื่อผู้ใช้พิมพ์ในช่อง input
        searchInput.addEventListener("keyup", filterTable);

        // เรียกใช้ฟังก์ชันค้นหาเมื่อคลิกปุ่มค้นหา
        const searchButton = document.getElementById("search-button");
        searchButton.addEventListener("click", filterTable);
      });

      document.addEventListener("DOMContentLoaded", () => {
        const searchInput = document.getElementById("type-search-input");
        const typeTable = document.getElementById("type-table");
        const tableRows = typeTable.querySelectorAll("tbody tr");

        function filterTable() {
          const searchTerm = searchInput.value.toLowerCase();

          tableRows.forEach((row) => {
            // คอลัมน์ "Name" ในตารางประเภทอาหารคือคอลัมน์ที่ 2
            const nameCell = row.querySelector("td:nth-child(2)");
            if (nameCell) {
              const typeName = nameCell.textContent.toLowerCase();
              if (typeName.includes(searchTerm)) {
                row.style.display = ""; // แสดงแถวนี้
              } else {
                row.style.display = "none"; // ซ่อนแถวนี้
              }
            }
          });
        }

        // เรียกใช้ฟังก์ชันค้นหาเมื่อมีการพิมพ์ในช่อง input
        searchInput.addEventListener("keyup", filterTable);

        // เรียกใช้ฟังก์ชันค้นหาเมื่อคลิกปุ่มค้นหา
        const searchButton = document.getElementById("type-search-button");
        searchButton.addEventListener("click", filterTable);
      });
    </script>
  </head>
  <body>
    <header>
      <nav>
        <a href="/"> หน้าแรก </a> | <a href="/food"> รายการอาหาร </a> |
        <a href="/type"> ประเภทอาหาร </a>
      </nav>
    </header>
  </body>
</html>
